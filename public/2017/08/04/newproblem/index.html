<!doctype html>
<html lang="zh-CN">
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  <meta name="keywords" content="C++ python 大并发网络 逆向">
  <meta name="description" content="重剑无锋，大巧不工">
  <meta name="author" content="恋恋风辰">

  
  <title>网络编程一些常见问题总结</title>
  

  <link rel="alternate" href="/atom.xml" title="恋恋风辰的个人博客" type="application/atom+xml">
  <link rel="canonical" href="http://www.limerence2017.com/2017/08/04/newproblem/index.html">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="//at.alicdn.com/t/font_pb2xepysv85gsyvi.css">
  <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</head>


  <body>
    <aside class="aside">
  <nav class="aside-menu">
    <ul class="aside-list">
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-wendang"></i><a href="/index.html" class="aside-menu-link" title="首页">首页</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-wendang1"></i><a href="/archives/index.html" class="aside-menu-link" title="所有文章">所有文章</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-biaoqian1"></i><a href="/tags/index.html" class="aside-menu-link" title="文章分类">文章分类</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-lianjie"></i><a href="/links/index.html" class="aside-menu-link" title="我和我的小伙伴">我和我的小伙伴</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-guanyu"></i><a href="/about/index.html" class="aside-menu-link" title="作者简介">作者简介</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-rss"></i><a href="/atom.xml" class="aside-menu-link" title="RSS">RSS</a></li>
        
      
    </ul>
  </nav>

  <article class="aside-show">
    
      <form class="search-from" id="search-from">
  <input class="search-text" id="search-text" type="text" name="searchText" value="" autocomplete="off">
  <button class="search-btn" id="search-btn" type="button"><i class="search-btn-icon iconfont icon-sousuo-sousuo"></i></button>
</form>

      <article class="search-data" id="search-data">
  <button class="search-close" id="search-close"><i class="search-close-icon iconfont icon-houdongfangiconfont10"></i></button>

  <div class="search-wrapper" id="search-wrapper"></div>
</article>

    
    <div class="aside-show-wrapper">
      <figure class="aside-avatar">
        <img src="/img/avatar.png" alt="avatar" class="aside-avatar-img">
        <figcaption class="aside-avatar-caption">
          恋恋风辰
          
          <strong class="aside-avatar-STRONG">个人博客</strong>
          
        </figcaption>
      </figure>
      <p class="aside-show-description">重剑无锋，大巧不工。</p>
      <ul class="aside-show-info">
        <li class="aside-show-item">
          <a href="javascript: void(0);" class="aside-show-link" title="微信" target="_blank"><i class="aside-show-icon iconfont icon-iconfontweixin"></i></a>
          <div class="aside-show-outside aside-show-outside_1">
            <img class="aside-show-IMG aside-show-IMG_1" src="/img/weixin.png" alt="微信">
          </div>
        </li>
        <li class="aside-show-item"><a href="https://www.zhihu.com/people/wang-wu-chen-32/activities" class="aside-show-link" title="知乎" target="_blank"><i class="aside-show-icon iconfont icon-zhihu"></i></a></li>
        <li class="aside-show-item"><a href="https://github.com/secondtonone1" class="aside-show-link" title="github" target="_blank"><i class="aside-show-icon iconfont icon-github"></i></a></li>
        <li class="aside-show-item">
          <a href="javascript: void(0);" class="aside-show-link" title="QQ" target="_blank"><i class="aside-show-icon iconfont icon-qq"></i></a>
          <div class="aside-show-outside">
            <img class="aside-show-IMG" src="/img/qq.png" alt="QQ">
          </div>
        </li>
      </ul>
    </div>
  </article>
</aside>


    <article class="main" id="main">
      <article class="post min-height">
  
  <header class="post-header">
    
    <h1 class="post-title">网络编程一些常见问题总结</h1>
    <p class="post-meta">
      <span class="post-time">2017-08-04</span>
      
      <a href="/categories/tech/" title="技术开发" class="post-categories">技术开发</a>
      
      
      <a href="/tags/网络编程/"" title="网络编程" class="post-tags"><i class="post-tags-icon iconfont icon-biaoqian"></i>网络编程</a>
      
    </p>
    
  </header>
  <div class="post-content"><h2 id="1-设置网络socket非阻塞："><a href="#1-设置网络socket非阻塞：" class="headerlink" title="1 设置网络socket非阻塞："></a>1 设置网络socket非阻塞：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">u_long has = <span class="number">1</span>;</div><div class="line">ioctl(m_sock, FIONBIO , &amp;has);</div></pre></td></tr></table></figure>
<p>这个函数很有可能返回success，却并没有设置成功。<br>windows对此有优化，对于linux版本应采用fcntl设置。</p>
<p>总结如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span></div><div class="line">make_socket_nonblocking(sockfd fd)</div><div class="line">&#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> WIN32</span></div><div class="line">    &#123;</div><div class="line">        u_long nonblocking = <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (ioctlsocket(fd, FIONBIO, &amp;nonblocking) == SOCKET_ERROR) &#123;</div><div class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"fcntl failed, fd is : "</span> &lt;&lt; fd; </div><div class="line">            </div><div class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">int</span> flags;</div><div class="line">        <span class="keyword">if</span> ((flags = fcntl(fd, F_GETFL, <span class="literal">NULL</span>)) &lt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"fcntl failed, fd is : "</span> &lt;&lt; fd;</div><div class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (fcntl(fd, F_SETFL, flags | O_NONBLOCK) == <span class="number">-1</span>) &#123;</div><div class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"fcntl failed, fd is : "</span> &lt;&lt; fd;</div><div class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<h2 id="2-windows环境下查看错误"><a href="#2-windows环境下查看错误" class="headerlink" title="2 windows环境下查看错误"></a>2 windows环境下查看错误</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">使用WSAGetLastError函数需要配置</div><div class="line"> </div><div class="line">lib,<span class="string">"ws2_32.lib"</span></div></pre></td></tr></table></figure>
<h2 id="3-EPOLLET这个宏是最小int"><a href="#3-EPOLLET这个宏是最小int" class="headerlink" title="3 EPOLLET这个宏是最小int"></a>3 EPOLLET这个宏是最小int</h2><p>EPOLLET这个宏的数值为-2147483648， 是能表示的最小int值。</p>
<h2 id="4-make-警告：检测到时钟错误。您的创建可能是不完整的。"><a href="#4-make-警告：检测到时钟错误。您的创建可能是不完整的。" class="headerlink" title="4 make: 警告：检测到时钟错误。您的创建可能是不完整的。"></a>4 make: 警告：检测到时钟错误。您的创建可能是不完整的。</h2><p>可以通过ls -l查看具体的是哪个文件的时间错了，就可以对症下药了，直接 “ touch 对应文件 “ 就可以解决这个问题。</p>
<p>或者读者可以用 “ touch * “ 来更新整个项目文件的时间,这也可以解决问题。</p>
<h2 id="5-select-fd-set-对于不同平台实现是不同的"><a href="#5-select-fd-set-对于不同平台实现是不同的" class="headerlink" title="5 select fd_set 对于不同平台实现是不同的"></a>5 select fd_set 对于不同平台实现是不同的</h2><p>在windows平台实现<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">fd_set</span> &#123;</span></div><div class="line">        u_int fd_count;               <span class="comment">/* how many are SET? */</span></div><div class="line">        SOCKET  fd_array[FD_SETSIZE];   <span class="comment">/* an array of SOCKETs */</span></div><div class="line">&#125; fd_set;</div></pre></td></tr></table></figure></p>
<p>很明了，一个计数的fd_count，另一个就是SOCKET数组。其中，FD_SETSIZE是可以设置的。整个fd_set的过程实际上就是将对应的<br>fd_count作为数组下标，数组元素存储的是对应socket fd。比如说当前读事件集合readset的fd_count 为7，当要监控socket fd为5 的读事件到来时，那么readset这个集合中下标为8的数组元素为5，fd_count  = 8以此类推。当调用select时，会返回对应读，写集合所有的描述符数组，并且重置内部的fd_count数量，然后分别调用读写函数即可。</p>
<p>下面是fd_set在linux下的实现：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></div><div class="line"><span class="class">  &#123;</span></div><div class="line">    <span class="comment">/* XPG4.2 requires this member name.  Otherwise avoid the name</span></div><div class="line"><span class="comment">       from the global namespace.  */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __USE_XOPEN</span></div><div class="line">    __fd_mask fds_bits[__FD_SETSIZE / __NFDBITS];</div><div class="line"><span class="meta"># <span class="meta-keyword">define</span> __FDS_BITS(set) ((set)-&gt;fds_bits)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">else</span> </span></div><div class="line">    __fd_mask __fds_bits[__FD_SETSIZE / __NFDBITS];</div><div class="line"><span class="meta"># <span class="meta-keyword">define</span> __FDS_BITS(set) ((set)-&gt;__fds_bits)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">  &#125; fd_set;</div></pre></td></tr></table></figure></p>
<p>根据UNIX网络编程对fd_set的介绍，fd_set是个整数数组，用每个bit位来表示fd的。比如，一个32位整数，则数组第一个整数表示0-31的fd，以此类推，第二个整数表示32-63<br>查看linux的FD_SET、FD_CLR是用汇编实现的。根据说明可以知道，就是给bit置位。<br>fd_set在不同平台实现的机制不一样，select第一个参数在linux环境下表示最大描述符数+1。windows无意义。</p>
<p>下面是我根据libevent早期版本实现的一套select模型：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"modelmanager.h"</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> WIN32</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"netmodeldef.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> XFREE(ptr) do &#123; <span class="meta-keyword">if</span> (ptr) free(ptr); &#125; while (0)</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">win_fd_set</span> &#123;</span></div><div class="line">    u_int fd_count;</div><div class="line">    SOCKET fd_array[<span class="number">1</span>];</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">win32op</span> &#123;</span></div><div class="line">    <span class="keyword">unsigned</span> num_fds_in_fd_sets;</div><div class="line">    <span class="keyword">int</span> resize_out_sets;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">win_fd_set</span> *<span class="title">readset_in</span>;</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">win_fd_set</span> *<span class="title">writeset_in</span>;</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">win_fd_set</span> *<span class="title">readset_out</span>;</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">win_fd_set</span> *<span class="title">writeset_out</span>;</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">win_fd_set</span> *<span class="title">exset_out</span>;</span></div><div class="line">    <span class="keyword">unsigned</span> signals_are_broken : <span class="number">1</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> *<span class="title">win32_init</span><span class="params">(<span class="keyword">void</span> *)</span></span>;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">win32_add</span><span class="params">(<span class="keyword">void</span> *, sockfd, <span class="keyword">short</span> old, <span class="keyword">short</span> events, <span class="keyword">void</span> *_idx)</span></span>;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">win32_del</span><span class="params">(<span class="keyword">void</span> *, sockfd, <span class="keyword">short</span> old, <span class="keyword">short</span> events, <span class="keyword">void</span> *_idx)</span></span>;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">win32_dispatch</span><span class="params">(<span class="keyword">void</span> *base, struct timeval *)</span></span>;</div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">win32_dealloc</span><span class="params">(<span class="keyword">void</span> *)</span></span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ModelOp</span> <span class="title">win32ops</span> = &#123;</span></div><div class="line">    <span class="string">"win32"</span>,</div><div class="line">    win32_init,</div><div class="line">    win32_add,</div><div class="line">    win32_del,</div><div class="line">    win32_dispatch,</div><div class="line">    win32_dealloc,</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> FD_SET_ALLOC_SIZE(n) ((sizeof(struct win_fd_set) + ((n)-1)*sizeof(SOCKET)))</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span></div><div class="line">grow_fd_sets(struct win32op *op, <span class="keyword">unsigned</span> new_num_fds)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">size_t</span> size;</div><div class="line"></div><div class="line">    <span class="keyword">if</span>( !(new_num_fds &gt;= op-&gt;readset_in-&gt;fd_count &amp;&amp;</div><div class="line">        new_num_fds &gt;= op-&gt;writeset_in-&gt;fd_count) )</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    <span class="keyword">if</span>( !(new_num_fds &gt;= <span class="number">1</span>) )</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line"></div><div class="line">    size = FD_SET_ALLOC_SIZE(new_num_fds);</div><div class="line">    <span class="keyword">if</span> (!(op-&gt;readset_in = (struct win_fd_set *)<span class="built_in">realloc</span>(op-&gt;readset_in, size)))</div><div class="line">        <span class="keyword">return</span> (<span class="number">-1</span>);</div><div class="line">    <span class="keyword">if</span> (!(op-&gt;writeset_in = (struct win_fd_set *)<span class="built_in">realloc</span>(op-&gt;writeset_in, size)))</div><div class="line">        <span class="keyword">return</span> (<span class="number">-1</span>);</div><div class="line">    op-&gt;resize_out_sets = <span class="number">1</span>;</div><div class="line">    op-&gt;num_fds_in_fd_sets = new_num_fds;</div><div class="line">    <span class="keyword">return</span> (<span class="number">0</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span></div><div class="line">do_fd_set(struct win32op *op, struct SocketIndex *ent, SOCKET s, <span class="keyword">int</span> read)</div><div class="line">&#123;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">win_fd_set</span> *<span class="title">set</span> = <span class="title">read</span> ? <span class="title">op</span>-&gt;<span class="title">readset_in</span> :</span> op-&gt;writeset_in;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (read) &#123;</div><div class="line">        <span class="keyword">if</span> (ent-&gt;read_pos_plus1 &gt; <span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> (<span class="number">0</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">if</span> (ent-&gt;write_pos_plus1 &gt; <span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> (<span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (<span class="built_in">set</span>-&gt;fd_count == op-&gt;num_fds_in_fd_sets) &#123;</div><div class="line">        <span class="keyword">if</span> (grow_fd_sets(op, op-&gt;num_fds_in_fd_sets*<span class="number">2</span>))</div><div class="line">            <span class="keyword">return</span> (<span class="number">-1</span>);</div><div class="line">        <span class="comment">// set pointer will have changed and needs reiniting!</span></div><div class="line">        <span class="built_in">set</span> = read ? op-&gt;readset_in : op-&gt;writeset_in;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">set</span>-&gt;fd_array[<span class="built_in">set</span>-&gt;fd_count] = s;</div><div class="line">    <span class="keyword">if</span> (read)</div><div class="line">        ent-&gt;read_pos_plus1 = <span class="built_in">set</span>-&gt;fd_count+<span class="number">1</span>;</div><div class="line">    <span class="keyword">else</span></div><div class="line">        ent-&gt;write_pos_plus1 = <span class="built_in">set</span>-&gt;fd_count+<span class="number">1</span>;</div><div class="line">    <span class="keyword">return</span> (<span class="built_in">set</span>-&gt;fd_count++);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span></div><div class="line">do_fd_clear(<span class="keyword">void</span> *base,</div><div class="line">struct win32op *op, struct SocketIndex *ent, <span class="keyword">int</span> read)</div><div class="line">&#123;</div><div class="line">    ModelManager* pDispatcher = (ModelManager*)base;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> i;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">win_fd_set</span> *<span class="title">set</span> = <span class="title">read</span> ? <span class="title">op</span>-&gt;<span class="title">readset_in</span> :</span> op-&gt;writeset_in;</div><div class="line">    <span class="keyword">if</span> (read) &#123;</div><div class="line">        i = ent-&gt;read_pos_plus1 - <span class="number">1</span>;</div><div class="line">        ent-&gt;read_pos_plus1 = <span class="number">0</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        i = ent-&gt;write_pos_plus1 - <span class="number">1</span>;</div><div class="line">        ent-&gt;write_pos_plus1 = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (i &lt; <span class="number">0</span>)</div><div class="line">        <span class="keyword">return</span> (<span class="number">0</span>);</div><div class="line">    <span class="keyword">if</span> (--<span class="built_in">set</span>-&gt;fd_count != (<span class="keyword">unsigned</span>)i) &#123;</div><div class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">SocketIndex</span> *<span class="title">ent2</span>;</span></div><div class="line">        SOCKET s2;</div><div class="line">        s2 = <span class="built_in">set</span>-&gt;fd_array[i] = <span class="built_in">set</span>-&gt;fd_array[<span class="built_in">set</span>-&gt;fd_count];</div><div class="line"></div><div class="line">        ent2 = pDispatcher-&gt;getSocketIndex( s2 );</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!ent2) <span class="comment">// This indicates a bug.</span></div><div class="line">            <span class="keyword">return</span> (<span class="number">0</span>);</div><div class="line">        <span class="keyword">if</span> (read)</div><div class="line">            ent2-&gt;read_pos_plus1 = i+<span class="number">1</span>;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            ent2-&gt;write_pos_plus1 = i+<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> (<span class="number">0</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NEVENT 32</span></div><div class="line"><span class="keyword">void</span> *</div><div class="line">win32_init(<span class="keyword">void</span> *base)</div><div class="line">&#123;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">win32op</span> *<span class="title">winop</span>;</span></div><div class="line">    <span class="keyword">size_t</span> size;</div><div class="line">    <span class="keyword">if</span> (!(winop = (struct win32op*)<span class="built_in">malloc</span>( <span class="keyword">sizeof</span>(struct win32op))))</div><div class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">    winop-&gt;num_fds_in_fd_sets = NEVENT;</div><div class="line">    size = FD_SET_ALLOC_SIZE(NEVENT);</div><div class="line">    <span class="keyword">if</span> (!(winop-&gt;readset_in = (struct win_fd_set *)<span class="built_in">malloc</span>(size)))</div><div class="line">        <span class="keyword">goto</span> err;</div><div class="line">    <span class="keyword">if</span> (!(winop-&gt;writeset_in = (struct win_fd_set *)<span class="built_in">malloc</span>(size)))</div><div class="line">        <span class="keyword">goto</span> err;</div><div class="line">    <span class="keyword">if</span> (!(winop-&gt;readset_out = (struct win_fd_set *)<span class="built_in">malloc</span>(size)))</div><div class="line">        <span class="keyword">goto</span> err;</div><div class="line">    <span class="keyword">if</span> (!(winop-&gt;writeset_out = (struct win_fd_set *)<span class="built_in">malloc</span>(size)))</div><div class="line">        <span class="keyword">goto</span> err;</div><div class="line">    <span class="keyword">if</span> (!(winop-&gt;exset_out = (struct win_fd_set *)<span class="built_in">malloc</span>(size)))</div><div class="line">        <span class="keyword">goto</span> err;</div><div class="line">    winop-&gt;readset_in-&gt;fd_count = winop-&gt;writeset_in-&gt;fd_count = <span class="number">0</span>;</div><div class="line">    winop-&gt;readset_out-&gt;fd_count = winop-&gt;writeset_out-&gt;fd_count</div><div class="line">        = winop-&gt;exset_out-&gt;fd_count = <span class="number">0</span>;</div><div class="line"></div><div class="line">    winop-&gt;resize_out_sets = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> (winop);</div><div class="line">err:</div><div class="line">    XFREE(winop-&gt;readset_in);</div><div class="line">    XFREE(winop-&gt;writeset_in);</div><div class="line">    XFREE(winop-&gt;readset_out);</div><div class="line">    XFREE(winop-&gt;writeset_out);</div><div class="line">    XFREE(winop-&gt;exset_out);</div><div class="line">    XFREE(winop);</div><div class="line">    <span class="keyword">return</span> (<span class="literal">NULL</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span></div><div class="line">win32_add(<span class="keyword">void</span> *base, SOCKET fd,</div><div class="line">          <span class="keyword">short</span> old, <span class="keyword">short</span> events, <span class="keyword">void</span> *_idx)</div><div class="line">&#123;</div><div class="line">    ModelManager* pDispatcher = (ModelManager*)base;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">win32op</span> *<span class="title">winop</span> = (<span class="title">struct</span> <span class="title">win32op</span> *)<span class="title">pDispatcher</span>-&gt;<span class="title">getModelData</span>();</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">SocketIndex</span> *<span class="title">idx</span> = (<span class="title">struct</span> <span class="title">SocketIndex</span> *)_<span class="title">idx</span>;</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!(events &amp; (EV_READ|EV_WRITE)))</div><div class="line">        <span class="keyword">return</span> (<span class="number">0</span>);</div><div class="line"></div><div class="line">    <span class="comment">//event_debug(("%s: adding event for %d", __func__, (int)fd));</span></div><div class="line">    <span class="keyword">if</span> (events &amp; EV_READ) &#123;</div><div class="line">        <span class="keyword">if</span> (do_fd_set(winop, idx, fd, <span class="number">1</span>)&lt;<span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> (<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (events &amp; EV_WRITE) &#123;</div><div class="line">        <span class="keyword">if</span> (do_fd_set(winop, idx, fd, <span class="number">0</span>)&lt;<span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> (<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> (<span class="number">0</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span></div><div class="line">win32_del(<span class="keyword">void</span> *base, SOCKET fd, <span class="keyword">short</span> old, <span class="keyword">short</span> events,</div><div class="line">          <span class="keyword">void</span> *_idx)</div><div class="line">&#123;</div><div class="line">    ModelManager* pDispatcher = (ModelManager*)base;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">win32op</span> *<span class="title">winop</span> = (<span class="title">struct</span> <span class="title">win32op</span> *)<span class="title">pDispatcher</span>-&gt;<span class="title">getModelData</span>();</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">SocketIndex</span> *<span class="title">idx</span> = (<span class="title">struct</span> <span class="title">SocketIndex</span> *)_<span class="title">idx</span>;</span></div><div class="line"></div><div class="line">    <span class="comment">//event_debug(("%s: Removing event for "EV_SOCK_FMT,__func__, EV_SOCK_ARG(fd)));</span></div><div class="line">    <span class="keyword">if</span> ( (old &amp; EV_READ) &amp;&amp; !(events &amp; EV_READ) )</div><div class="line">        do_fd_clear(base, winop, idx, <span class="number">1</span>);</div><div class="line">    <span class="keyword">if</span> ( (old &amp; EV_WRITE) &amp;&amp; !(events &amp; EV_WRITE) )</div><div class="line">        do_fd_clear(base, winop, idx, <span class="number">0</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">void</span></div><div class="line">fd_set_copy(struct win_fd_set *out, <span class="keyword">const</span> struct win_fd_set *in)</div><div class="line">&#123;</div><div class="line">    out-&gt;fd_count = in-&gt;fd_count;</div><div class="line">    <span class="built_in">memcpy</span>(out-&gt;fd_array, in-&gt;fd_array, in-&gt;fd_count * (<span class="keyword">sizeof</span>(SOCKET)));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">static void dump_fd_set(struct win_fd_set *s)</span></div><div class="line"><span class="comment">&#123;</span></div><div class="line"><span class="comment">unsigned int i;</span></div><div class="line"><span class="comment">printf("[ ");</span></div><div class="line"><span class="comment">for(i=0;i&lt;s-&gt;fd_count;++i)</span></div><div class="line"><span class="comment">printf("%d ",(int)s-&gt;fd_array[i]);</span></div><div class="line"><span class="comment">printf("]\n");</span></div><div class="line"><span class="comment">&#125;</span></div><div class="line"><span class="comment">*/</span></div><div class="line"></div><div class="line"><span class="keyword">int</span></div><div class="line">win32_dispatch(<span class="keyword">void</span> *base, struct timeval *tv)</div><div class="line">&#123;</div><div class="line">    ModelManager* pDispatcher = (ModelManager*)base;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">win32op</span> *<span class="title">winop</span> = (<span class="title">struct</span> <span class="title">win32op</span> *)<span class="title">pDispatcher</span>-&gt;<span class="title">getModelData</span>();</span></div><div class="line">    <span class="keyword">int</span> res = <span class="number">0</span>;</div><div class="line">    <span class="keyword">unsigned</span> j, i;</div><div class="line">    <span class="keyword">int</span> fd_count;</div><div class="line">    SOCKET s;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (winop-&gt;resize_out_sets) &#123;</div><div class="line">        <span class="keyword">size_t</span> size = FD_SET_ALLOC_SIZE(winop-&gt;num_fds_in_fd_sets);</div><div class="line">        <span class="keyword">if</span> (!(winop-&gt;readset_out = (struct win_fd_set *)<span class="built_in">realloc</span>(winop-&gt;readset_out, size)))</div><div class="line">            <span class="keyword">return</span> (<span class="number">-1</span>);</div><div class="line">        <span class="keyword">if</span> (!(winop-&gt;exset_out = (struct win_fd_set *)<span class="built_in">realloc</span>(winop-&gt;exset_out, size)))</div><div class="line">            <span class="keyword">return</span> (<span class="number">-1</span>);</div><div class="line">        <span class="keyword">if</span> (!(winop-&gt;writeset_out = (struct win_fd_set *)<span class="built_in">realloc</span>(winop-&gt;writeset_out, size)))</div><div class="line">            <span class="keyword">return</span> (<span class="number">-1</span>);</div><div class="line">        winop-&gt;resize_out_sets = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    fd_set_copy(winop-&gt;readset_out, winop-&gt;readset_in);</div><div class="line">    fd_set_copy(winop-&gt;exset_out, winop-&gt;writeset_in);</div><div class="line">    fd_set_copy(winop-&gt;writeset_out, winop-&gt;writeset_in);</div><div class="line"></div><div class="line">    fd_count =</div><div class="line">        (winop-&gt;readset_out-&gt;fd_count &gt; winop-&gt;writeset_out-&gt;fd_count) ?</div><div class="line">        winop-&gt;readset_out-&gt;fd_count : winop-&gt;writeset_out-&gt;fd_count;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!fd_count) &#123;</div><div class="line">        Sleep(tv-&gt;tv_usec/<span class="number">1000</span>);</div><div class="line">        <span class="keyword">return</span> (<span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    res = select(fd_count,</div><div class="line">        (struct fd_set*)winop-&gt;readset_out,</div><div class="line">        (struct fd_set*)winop-&gt;writeset_out,</div><div class="line">        (struct fd_set*)winop-&gt;exset_out, tv);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//event_debug(("%s: select returned %d", __func__, res));</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> (res &lt;= <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">if</span>( res == <span class="number">-1</span> )</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"error:%d\n"</span>, getErrno() );</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> res;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (winop-&gt;readset_out-&gt;fd_count) &#123;</div><div class="line">        i = rand() % winop-&gt;readset_out-&gt;fd_count;</div><div class="line">        <span class="keyword">for</span> (j=<span class="number">0</span>; j&lt;winop-&gt;readset_out-&gt;fd_count; ++j) &#123;</div><div class="line">            <span class="keyword">if</span> (++i &gt;= winop-&gt;readset_out-&gt;fd_count)</div><div class="line">                i = <span class="number">0</span>;</div><div class="line">            s = winop-&gt;readset_out-&gt;fd_array[i];</div><div class="line">            pDispatcher-&gt;insertActiveList( s, EV_READ);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (winop-&gt;exset_out-&gt;fd_count) &#123;</div><div class="line">        i = rand() % winop-&gt;exset_out-&gt;fd_count;</div><div class="line">        <span class="keyword">for</span> (j=<span class="number">0</span>; j&lt;winop-&gt;exset_out-&gt;fd_count; ++j) &#123;</div><div class="line">            <span class="keyword">if</span> (++i &gt;= winop-&gt;exset_out-&gt;fd_count)</div><div class="line">                i = <span class="number">0</span>;</div><div class="line">            s = winop-&gt;exset_out-&gt;fd_array[i];</div><div class="line">            pDispatcher-&gt;insertActiveList( s, EV_WRITE);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (winop-&gt;writeset_out-&gt;fd_count) &#123;</div><div class="line">        SOCKET s;</div><div class="line">        i = rand() % winop-&gt;writeset_out-&gt;fd_count;</div><div class="line">        <span class="keyword">for</span> (j=<span class="number">0</span>; j&lt;winop-&gt;writeset_out-&gt;fd_count; ++j) &#123;</div><div class="line">            <span class="keyword">if</span> (++i &gt;= winop-&gt;writeset_out-&gt;fd_count)</div><div class="line">                i = <span class="number">0</span>;</div><div class="line">            s = winop-&gt;writeset_out-&gt;fd_array[i];</div><div class="line">            pDispatcher-&gt;insertActiveList( s, EV_WRITE);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> (<span class="number">0</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span></div><div class="line">win32_dealloc(<span class="keyword">void</span> *base)</div><div class="line">&#123;</div><div class="line">    ModelManager* pDispatcher = (ModelManager*)base;</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">win32op</span> *<span class="title">winop</span> = (<span class="title">struct</span> <span class="title">win32op</span> *)<span class="title">pDispatcher</span>-&gt;<span class="title">getModelData</span>();</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> (winop-&gt;readset_in)</div><div class="line">        <span class="built_in">free</span>(winop-&gt;readset_in);</div><div class="line">    <span class="keyword">if</span> (winop-&gt;writeset_in)</div><div class="line">        <span class="built_in">free</span>(winop-&gt;writeset_in);</div><div class="line">    <span class="keyword">if</span> (winop-&gt;readset_out)</div><div class="line">        <span class="built_in">free</span>(winop-&gt;readset_out);</div><div class="line">    <span class="keyword">if</span> (winop-&gt;writeset_out)</div><div class="line">        <span class="built_in">free</span>(winop-&gt;writeset_out);</div><div class="line">    <span class="keyword">if</span> (winop-&gt;exset_out)</div><div class="line">        <span class="built_in">free</span>(winop-&gt;exset_out);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="built_in">memset</span>(winop, <span class="number">0</span>, <span class="keyword">sizeof</span>(winop));</div><div class="line">    <span class="built_in">free</span>(winop);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure></p>
</div>
    
      <p class="post-copyright">若无特别说明，本文系原创，<a class="post-copyright-link" href="https://creativecommons.org/licenses/by/4.0/deed.zh" title="署名-非商业性使用 4.0 (CC BY-NC 4.0)" target="_blank">署名-非商业性使用 4.0 (CC BY-NC 4.0)</a>协议，转载文章请注明来自<a class="post-copyright-link" href="/" title="恋恋风辰的个人博客" target="_blank">恋恋风辰的个人博客</a>，或链接上原文地址：<a class="post-copyright-link" href="http://www.limerence2017.com/2017/08/04/newproblem/" title="http://www.limerence2017.com/2017/08/04/newproblem/" target="_blank">http://www.limerence2017.com/2017/08/04/newproblem/</a></p>

      
      <div class="toc-wrapper">
        <div class="toc-scroll">
          <div class="toc-middle">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-设置网络socket非阻塞："><span class="toc-text">1 设置网络socket非阻塞：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-windows环境下查看错误"><span class="toc-text">2 windows环境下查看错误</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-EPOLLET这个宏是最小int"><span class="toc-text">3 EPOLLET这个宏是最小int</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-make-警告：检测到时钟错误。您的创建可能是不完整的。"><span class="toc-text">4 make: 警告：检测到时钟错误。您的创建可能是不完整的。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-select-fd-set-对于不同平台实现是不同的"><span class="toc-text">5 select fd_set 对于不同平台实现是不同的</span></a></li></ol>
          </div>
        </div>
      </div>
    
  
</article>

      <footer class="footer">
  <p class="footer-text">驱动于 <a href="https://hexo.io/zh-cn/" class="footer-link" title="Hexo">Hexo</a>，主题由 <a href="/about" class="footer-link" title="恋恋风辰">恋恋风辰</a> 设计移植而来</p>
  <p class="footer-text">&copy; 2016 - 2017 <a href="/about" class="footer-link" title="恋恋风辰">恋恋风辰</a> 保留部分版权</p>
</footer>

    </article>

    <script src="/js/to-top.js"></script>
    <script src="/js/search.js"></script>
  </body>
</html>
